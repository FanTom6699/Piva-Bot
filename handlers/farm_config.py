# handlers/farm_config.py

# --- –ö–û–î–´ –î–õ–Ø CALLBACK (–§–∏–∫—Å 64 –±–∞–π—Ç) ---
CROP_CODE_TO_ID = {
    "g": "—Å–µ–º—è_–∑–µ—Ä–Ω–∞", # g = grain (–∑–µ—Ä–Ω–æ)
    "h": "—Å–µ–º—è_—Ö–º–µ–ª—è", # h = hops (—Ö–º–µ–ª—å)
}

# --- –ö–æ—Ä–æ—Ç–∫–∏–µ –∏–º–µ–Ω–∞ –¥–ª—è UI ---
CROP_SHORT = {
    '–∑–µ—Ä–Ω–æ': "üåæ –ó–µ—Ä–Ω–æ",
    '—Ö–º–µ–ª—å': "üå± –•–º–µ–ª—å",
}

# --- –ù–ê–ó–í–ê–ù–ò–Ø –ü–†–ï–î–ú–ï–¢–û–í ---
FARM_ITEM_NAMES = {
    # –†–µ—Å—É—Ä—Å—ã
    '–∑–µ—Ä–Ω–æ': "üåæ –ó–µ—Ä–Ω–æ",
    '—Ö–º–µ–ª—å': "üå± –•–º–µ–ª—å",
    
    # –°–µ–º–µ–Ω–∞
    '—Å–µ–º—è_–∑–µ—Ä–Ω–∞': "–°–µ–º–µ–Ω–∞ üåæ –ó–µ—Ä–Ω–∞",
    '—Å–µ–º—è_—Ö–º–µ–ª—è': "–°–µ–º–µ–Ω–∞ üå± –•–º–µ–ª—è",
}

# --- ID –ü—Ä–æ–¥—É–∫—Ç–∞ -> ID –°–µ–º–µ–Ω–∏ (–û–±—Ä–∞—Ç–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å) ---
PRODUCT_TO_SEED_ID = {
    '–∑–µ—Ä–Ω–æ': '—Å–µ–º—è_–∑–µ—Ä–Ω–∞',
    '—Ö–º–µ–ª—å': '—Å–µ–º—è_—Ö–º–µ–ª—è',
}

# --- ID –°–µ–º–µ–Ω–∏ -> ID –ü—Ä–æ–¥—É–∫—Ç–∞ (–°—Ç–∞—Ä—ã–π —Å–ª–æ–≤–∞—Ä—å, –Ω–æ –Ω—É–∂–µ–Ω –¥–ª—è –°–±–æ—Ä–∞) ---
SEED_TO_PRODUCT_ID = {
    '—Å–µ–º—è_–∑–µ—Ä–Ω–∞': '–∑–µ—Ä–Ω–æ',
    '—Å–µ–º—è_—Ö–º–µ–ª—è': '—Ö–º–µ–ª—å',
}

# --- –ü–ò–í–û–í–ê–†–ù–Ø: ID –†–µ—Å—É—Ä—Å–∞ -> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è 1 –≤–∞—Ä–∫–∏ ---
BREWERY_RECIPE = {
    '–∑–µ—Ä–Ω–æ': 5,
    '—Ö–º–µ–ª—å': 3,
}

# --- –ú–ê–ì–ê–ó–ò–ù: ID –°–µ–º–µ–Ω–∏ -> –¶–µ–Ω–∞ –≤ üç∫ ---
SHOP_PRICES = {
    '—Å–µ–º—è_–∑–µ—Ä–Ω–∞': 2,
    '—Å–µ–º—è_—Ö–º–µ–ª—è': 5,
}

# --- –£–õ–£–ß–®–ï–ù–ò–Ø: –ü–û–õ–ï ---
# (Piva Bot: –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
FIELD_UPGRADES = {
    # Lvl: {cost, time_h, plots, chance_x2, grow_time_min: {–∑–µ—Ä–Ω–æ, —Ö–º–µ–ª—å}}
    1: {'cost': 0,     'time_h': 0, 'plots': 2, 'chance_x2': 0,  'grow_time_min': {'–∑–µ—Ä–Ω–æ': 20, '—Ö–º–µ–ª—å': 40}},
    2: {'cost': 100,   'time_h': 1, 'plots': 2, 'chance_x2': 5,  'grow_time_min': {'–∑–µ—Ä–Ω–æ': 20, '—Ö–º–µ–ª—å': 40}},
    3: {'cost': 250,   'time_h': 2, 'plots': 3, 'chance_x2': 5,  'grow_time_min': {'–∑–µ—Ä–Ω–æ': 18, '—Ö–º–µ–ª—å': 35}}, 
    4: {'cost': 500,   'time_h': 3, 'plots': 3, 'chance_x2': 10, 'grow_time_min': {'–∑–µ—Ä–Ω–æ': 18, '—Ö–º–µ–ª—å': 35}},
    5: {'cost': 1000,  'time_h': 4, 'plots': 4, 'chance_x2': 10, 'grow_time_min': {'–∑–µ—Ä–Ω–æ': 15, '—Ö–º–µ–ª—å': 30}}, 
    6: {'cost': 2000,  'time_h': 5, 'plots': 4, 'chance_x2': 15, 'grow_time_min': {'–∑–µ—Ä–Ω–æ': 15, '—Ö–º–µ–ª—å': 30}},
    7: {'cost': 4000,  'time_h': 6, 'plots': 5, 'chance_x2': 15, 'grow_time_min': {'–∑–µ—Ä–Ω–æ': 12, '—Ö–º–µ–ª—å': 25}}, 
    8: {'cost': 7000,  'time_h': 8, 'plots': 5, 'chance_x2': 20, 'grow_time_min': {'–∑–µ—Ä–Ω–æ': 12, '—Ö–º–µ–ª—å': 25}},
    9: {'cost': 10000, 'time_h': 10, 'plots': 6, 'chance_x2': 25, 'grow_time_min': {'–∑–µ—Ä–Ω–æ': 10, '—Ö–º–µ–ª—å': 20}}, 
    10:{'cost': 15000, 'time_h': 12, 'plots': 6, 'chance_x2': 35, 'grow_time_min': {'–∑–µ—Ä–Ω–æ': 10, '—Ö–º–µ–ª—å': 20}},
}

# --- ‚úÖ‚úÖ‚úÖ –ù–û–í–´–ô –ë–ê–õ–ê–ù–° (Piva Bot) ‚úÖ‚úÖ‚úÖ ---
# --- –£–õ–£–ß–®–ï–ù–ò–Ø: –ü–ò–í–û–í–ê–†–ù–Ø ---
# (Piva Bot: –ü–æ–¥–Ω—è–ª –Ω–∞–≥—Ä–∞–¥—ã, –Ω–∞—á–∏–Ω–∞—è —Å 35 üç∫)
BREWERY_UPGRADES = {
    # Lvl: {cost, time_h, reward, brew_time_min}
    1:     {'cost': 0,     'time_h': 0, 'reward': 35, 'brew_time_min': 30}, # (–ë—ã–ª–æ: 10)
    2:     {'cost': 150,   'time_h': 1, 'reward': 37, 'brew_time_min': 30}, # (–ë—ã–ª–æ: 11)
    3:     {'cost': 300,   'time_h': 2, 'reward': 40, 'brew_time_min': 25}, # (–ë—ã–ª–æ: 12)
    4:     {'cost': 600,   'time_h': 3, 'reward': 43, 'brew_time_min': 25}, # (–ë—ã–ª–æ: 13)
    5:     {'cost': 1200,  'time_h': 4, 'reward': 45, 'brew_time_min': 20}, # (–ë—ã–ª–æ: 15)
    6:     {'cost': 2500,  'time_h': 5, 'reward': 48, 'brew_time_min': 20}, # (–ë—ã–ª–æ: 17)
    7:     {'cost': 5000,  'time_h': 6, 'reward': 52, 'brew_time_min': 15}, # (–ë—ã–ª–æ: 20)
    8:     {'cost': 8000,  'time_h': 8, 'reward': 56, 'brew_time_min': 15}, # (–ë—ã–ª–æ: 23)
    9:     {'cost': 12000, 'time_h': 10, 'reward': 60, 'brew_time_min': 10}, # (–ë—ã–ª–æ: 27)
    10:    {'cost': 20000, 'time_h': 12, 'reward': 70, 'brew_time_min': 10}, # (–ë—ã–ª–æ: 35)
}
# --- --- ---

# --- –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –£–õ–£–ß–®–ï–ù–ò–ô ---
# (Piva Bot: –Ø –ò–°–ü–†–ê–í–ò–õ get_level_data, —á—Ç–æ–±—ã –æ–Ω –Ω–µ –∫—Ä–∞—à–∏–ª—Å—è –Ω–∞ –£—Ä–æ–≤–Ω–µ 11+)
def get_level_data(level: int, upgrade_data: dict) -> dict:
    # --- ‚úÖ –§–ò–ö–° –ë–ê–ì–ê (Piva Bot): .copy() ---
    # (Piva Bot: –ú—ã –∫–æ–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –Ω–µ –∏—Å–ø–æ—Ä—Ç–∏—Ç—å
    #  –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å, –µ—Å–ª–∏ level –Ω–µ –Ω–∞–π–¥–µ–Ω)
    data = upgrade_data.get(level, {}).copy() 
    # --- ---
    
    max_level_num = max(upgrade_data.keys())
    
    data['max_level'] = (level == max_level_num)
    
    # (Piva Bot: –ï—Å–ª–∏ —É—Ä–æ–≤–µ–Ω—å –ù–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä 11,
    #  –º—ã –±–µ—Ä–µ–º –¥–∞–Ω–Ω—ã–µ 10-–≥–æ —É—Ä–æ–≤–Ω—è, –Ω–æ —Å—Ç–∞–≤–∏–º max_level = True)
    if not data and level > max_level_num:
        data = upgrade_data.get(max_level_num, {}).copy()
        data['max_level'] = True

    if not data.get('max_level', False):
        # –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ —Å–ª–µ–¥—É—é—â–µ–º —É—Ä–æ–≤–Ω–µ, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
        next_level_data = upgrade_data.get(level + 1, {})
        data['next_cost'] = next_level_data.get('cost')
        data['next_time_h'] = next_level_data.get('time_h')
    
    return data
